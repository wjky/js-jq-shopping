-
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>jq购物车效果2</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/cart.css" />
</head>

<body>
    <div id="main" class="hander-car">
        <div class="store-content">
            <div class="cart-box">
                <div class="title">
                    <h2>购物清单</h2>
                </div>
                <div class="cart-inner">
                    <div>
                        <div class="cart-table-title">
                            <span class="name">商品信息</span>
                            <span class="operation">操作</span>
                            <span class="subtotal">小计</span>
                            <span class="num">数量</span>
                            <span class="price">单价</span>
                        </div>
                        <div class="cart-table">
                            <div class="cart-group">
                                <!--购物列表-->
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <!-- 勾选商品  选中：checkbox-on -->
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <!-- 小计 -->
                                        <div class="subtotal">¥ 49.00</div>
                                        <!-- 件数的操作 -->
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="1" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <!-- 单价 -->
                                        <div class="price">¥ 100.00</div>
                                    </div>
                                </div>
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <div class="subtotal">¥ 49.00</div>
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="1" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <div class="price">¥ 200</div>
                                    </div>
                                </div>
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <div class="subtotal">¥ 49.00</div>
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="10" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <div class="price">¥ 49.00</div>
                                    </div>
                                </div>
                                <div class="cart-top-items">
                                    <div class="cart-items">
                                        <div class="items-choose">
                                            <span class="blue-checkbox-new"><a></a></span>
                                        </div>
                                        <div class="items-thumb">
                                            <img src="./img/goods/s1.jpg">
                                            <a href="javascript:;" target="_blank"></a>
                                        </div>
                                        <div class="name hide-row">
                                            <div class="name-table">
                                                <a href="javascript:;" target="_blank">坚果 Pro 钢化玻璃手感膜 无孔 （后壳用）</a>
                                                <ul class="attribute">
                                                    <li>透明</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="operation">
                                        </div>
                                        <div class="subtotal">¥ 49.00</div>
                                        <div class="item-cols-num">
                                            <div class="select js-select-quantity">
                                                <span class="down down-disabled">-</span>
                                                <span class="num">
                                                    <input type="text" value="2" style="display: inline-block;">
                                                </span>
                                                <span class="up">+</span>

                                            </div>
                                        </div>
                                        <div class="price">¥ 58.00</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="cart-bottom-bg fix-bottom">
                    <div class="cart-bar-operation">
                        <div>
                            <div class="choose-all js-choose-all">
                                <span class="blue-checkbox-new" id="chooseall"><a></a></span>
                                全选
                            </div>
                            <!-- <div class="delete-choose-goods">删除选中的商品</div> -->
                        </div>
                    </div>
                    <div class="shipping">
                        <div class="shipping-box">
                            <div class="shipping-total shipping-num">
                                <h4 class="">
                                    已选择 <i id="yixuan">0</i> 件商品
                                </h4>
                                <h5>
                                    共计 <i id="gongji">0</i> 件商品
                                </h5>
                            </div>
                            <div class="shipping-total shipping-price">
                                <h4 class="">
                                    应付总额：<span>￥</span><i class="moneyall">0</i>
                                </h4>
                                <h5 class="shipping-tips">
                                    应付总额不含运费
                                </h5>

                            </div>
                        </div>
                        <span class="jianguo-blue-main-btn big-main-btn js-checkout disabled-btn"><a>现在结算</a></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src='https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js'></script>
    <script>

        function setClass() {
            var isOneCheck = $.makeArray($('.cart-group .blue-checkbox-new')).some(item => {
                return item.classList.contains('checkbox-on')
            });
            if (isOneCheck) {
                $('.js-checkout').removeClass('disabled-btn');
            } else {
                $('.js-checkout').addClass('disabled-btn');
            }
        }


        function xiaoji(index) {
            var danjia = $('.cart-group .price').eq(index).html().slice(1).trim();
            var shuliang = $('.num input').eq(index).val();
            $('.cart-group .subtotal').eq(index).html('￥' + Number(danjia) * Number(shuliang));
        }

        // 单选
        $('.cart-group .blue-checkbox-new').click(function () {
            $(this).toggleClass('checkbox-on');
            var isAllCheck = $.makeArray($('.cart-group .blue-checkbox-new')).every(item => {
                return item.classList.contains('checkbox-on')
            });

            if (isAllCheck) {
                $('#chooseall').addClass('checkbox-on');
            } else {
                $('#chooseall').removeClass('checkbox-on');
            }

            setClass()
            jiesuan()
        })

        // 全选
        $('#chooseall').click(function (e) {
            e.preventDefault();
            $(this).toggleClass('checkbox-on');
            if ($(this).hasClass('checkbox-on')) {
                $('.cart-group .blue-checkbox-new').addClass('checkbox-on')
            } else {
                $('.cart-group .blue-checkbox-new').removeClass('checkbox-on')
            }

            setClass()
            jiesuan();
        });


        // 初始化操作，改变加和减按钮的初始默认状态
        $('.num input').each(function (index, item) {
            // element == this
            
            // 加按钮的状态， 值为10，添加禁用样式，否则移除禁用样式
            if ($(this).val() == '10') {
                $('.up').eq(index).addClass('up-disabled')
            } else {
                $('.up').eq(index).removeClass('up-disabled')
            }

            // 减按钮的状态，值为1，添加禁用样式，否则移除禁用样式
            if ($(this).val() == '1') {
                $('.down').eq(index).addClass('down-disabled')
            } else {
                $('.down').eq(index).removeClass('down-disabled')
            }

            var danjia = $('.cart-group .price').eq(index).html().slice(1).trim();
            var shuliang = $(this).val();
            $('.cart-group .subtotal').eq(index).html('￥' + Number(danjia) * Number(shuliang));

        });

        // 点击加按钮
        $('.up').click(function (e) {
            e.preventDefault();
            var index = $('.up').index(this);
            var text = $('.num input').eq(index).val();
            text++;
            if (text >= 10) { text = 10 }
            $('.num input').eq(index).val(text);
            if (text == 10) { $('.up').eq(index).addClass('up-disabled') }
            if (text > 1) { $('.down').eq(index).removeClass('down-disabled') }

            xiaoji(index);

            gongji();
            jiesuan();
        });

        // 点击减按钮
        $('.down').click(function (e) {
            e.preventDefault();
            var index = $('.down').index(this);
            var text = $('.num input').eq(index).val();
            text--;
            if (text <= 1) { text = 1 }
            $('.num input').eq(index).val(text);
            if (text == 1) { $('.down').eq(index).addClass('down-disabled') }
            if (text < 10) { $('.up').eq(index).removeClass('up-disabled') }

            xiaoji(index);

            gongji();
            jiesuan();
        });


        // 共计
        function gongji() {
            var res = $.makeArray($('.num input')).reduce((a, b) => {
                return a + Number(b.value);
            }, 0)
            $('#gongji').html(res);
        }
        gongji();


        function jiesuan() {
            var yxNum = 0;
            var yfNum = 0;
            $('.cart-group .blue-checkbox-new').each(function (index, item) {
                // element == this
                if ($(this).hasClass('checkbox-on')) {
                    yxNum += Number($('.num input').eq(index).val())

                    var danjia = $('.cart-group .price').eq(index).html().slice(1).trim();
                    var shuliang = $('.num input').eq(index).val();
                    yfNum += Number(danjia) * Number(shuliang)
                }
            });
            $('#yixuan').html(yxNum)
            $('.moneyall').html(yfNum)
        }


        $('.num input').blur(function (e) {
            e.preventDefault();
            var index = $('.num input').index(this)
            var mynum = Number($(this).val());
            var reg = /^\d+$/;

            if (mynum > 10) {
                $(this).val(10)
                alert("最大10件")
            } else if (mynum < 1) {
                $(this).val(1)
                alert("最小1件")
            } else if (!reg.test(mynum)) {
                $(this).val(10)
                alert("非法字符");
            }

            xiaoji(index)
            gongji();
            jiesuan();


            // 加按钮的状态， 值为10，添加禁用样式，否则移除禁用样式
            if ($(this).val() == '10') {
                $('.up').eq(index).addClass('up-disabled')
            } else {
                $('.up').eq(index).removeClass('up-disabled')
            }

            // 减按钮的状态，值为1，添加禁用样式，否则移除禁用样式
            if ($(this).val() == '1') {
                $('.down').eq(index).addClass('down-disabled')
            } else {
                $('.down').eq(index).removeClass('down-disabled')
            }
            
        });


        /**
         选中: checkbox-on
         结算按钮样式: disabled-btn
         加减按钮禁用：down-disabled
         */
    </script>
</body>

</html>